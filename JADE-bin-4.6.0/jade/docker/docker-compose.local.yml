# Local single-machine overlay.
# Overrides PUBLIC_HOST per-service so JADE binds to Docker bridge addresses
# instead of the Tailscale IPs that may be set in docker/.env.
# Also exposes port 4000 for the web GUI.
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.local.yml --profile main up -d --build
#   docker compose -f docker-compose.yml -f docker-compose.local.yml --profile agent up -d

services:
  jade-main:
    environment:
      PUBLIC_HOST: "jade-main"

  jade-agent:
    environment:
      MAIN_HOST: "jade-main"
      PUBLIC_HOST: "jade-agent"

  user-ui:
    environment:
      MAIN_HOST: "jade-main"
      PUBLIC_HOST: "user-ui"
    ports:
      - "4000:4000"

  parser:
    environment:
      MAIN_HOST: "jade-main"
      PUBLIC_HOST: "parser"

  logic:
    environment:
      MAIN_HOST: "jade-main"
      PUBLIC_HOST: "logic"

  query:
    environment:
      MAIN_HOST: "jade-main"
      PUBLIC_HOST: "query"
