<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multi-Agent Clinic System</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>ğŸ¥ Multi-Agent Clinic System</h1>

    <div class="form-section">
      <h2>Facts and Relationships</h2>
      <textarea id="factInput" placeholder="Example: John is a doctor at the clinic"></textarea>
      <button onclick="submitFact()">Send</button>
    </div>

    <div class="form-section">
      <h2>Query</h2>
      <textarea id="queryInput" placeholder="Example: Who works at the clinic?"></textarea>
      <button onclick="submitQuery()">Send</button>
    </div>

    <hr style="margin: 40px 0;">

    <h2>ğŸ“‹ System Response</h2>
    <div id="response-box" class="response-box">
      <p id="agent-response">â³ Waiting for the response...</p>
    </div>
  </div>

  <script>
    

    function submitFact() {
      const input = document.getElementById('factInput').value;
      console.log("ğŸ“œ Fact submitted:", input);
      
      fetch('/send-fact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ fact: input })
      })
      .then(res => res.text())
      .then(response => {
        console.log("âœ… Response:", response);
        // Show status and start polling the answer from the backend (port 5002)
        document.getElementById("agent-response").innerText = "â³ Waiting for confirmation...";
        pollForResult();
      })
      .catch(error => {
        console.error("âŒ Error:", error);
        document.getElementById("agent-response").innerText = "âŒ Error sending the fact.";
      });
    }

    function submitQuery() {
      const input = document.getElementById("queryInput").value;
      console.log("ğŸ” Query submitted:", input);

      fetch('/send-query', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: input })
      })
      .then(() => {
        document.getElementById("agent-response").innerText = "â³ Waiting for a response...";
        pollForResult(); // << changed from setTimeout
      })
      .catch(error => {
        console.error("âŒ Error:", error);
        document.getElementById("agent-response").innerText = "âŒ Error sending query.";
      });
    }

    function pollForResult() {
      fetch('/get-query-result')
        .then(res => res.json())
        .then(data => {
          if (data.answer.includes("â³")) {
            // Still waiting â†’ retry in 1s
            setTimeout(pollForResult, 1000);
          } else {
            document.getElementById("agent-response").innerText = "ğŸ“¥ : " + data.answer;
          }
        })
        .catch(err => {
          console.error("âŒ Receive error:", err);
          document.getElementById("agent-response").innerText = "âŒ Error receiving result.";
        });
    }

  </script>
</body>
</html>
